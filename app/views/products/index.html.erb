<%# link para que el ver mas y ver menos funcione %>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<%# link para que el ver mas y ver menos funcione %>


<%# Banner %>
<div id="carouselExampleInterval" class="carousel slide position-relative" data-bs-ride="carousel">
  <!-- Imágenes del carousel -->
  <div class="carousel-inner">
    <div class="carousel-item active">
      <img src="https://img.freepik.com/fotos-premium/frasco-perfume-elegante-fondo-oscuro-creado-tecnologia-generativa-ai_919772-257.jpg" class="d-block w-100" alt="...">
    </div>
  </div>
  <!-- Banner de búsqueda superpuesto -->
  <div class="container-fluid bg-transparent position-absolute top-50 start-50 translate-middle z-index-1" style="top: 70%;">
    <div class="row justify-content-center align-items-center py-3">
      <div class="col-md-6">
        <h1 class="text-light text-center mb-3">Bienvenido a Le Parfum</h1>
        <form class="d-flex">
          <input class="form-control me-2" type="search" placeholder="Buscar productos..." aria-label="Search">
          <button class="btn btn-outline-light" type="submit">Buscar</button>
        </form>
      </div>
    </div>
  </div>
</div>
<%# Banner %>


<%# selector %>
<div class="container pt-3">
  <div class="row my-2 justify-content-end">
    <div class="col-auto">
      <div class="collection-filter__item collection-filter__item--sort float-end">
        <select class="form-select form-select-sm" id="SortBy" name="SortBy" data-default-sortby="best-selling">
          <option value="title-ascending" selected disabled hidden>Ordenar por...</option>
          <option value="price-ascending">Precio: menor a mayor</option>
          <option value="price-descending">Precio: mayor a menor</option>
          <option value="created-ascending">Fecha: antiguo(a) a reciente</option>
          <option value="created-descending">Fecha: reciente a antiguo(a)</option>
        </select>
      </div>
    </div>
  </div>
</div>
<%# selector %>


<%# card %>
<div class="container pt-3">
  <div class="row my-2" id="productContainer">
    <% @products.each do |product| %>
      <div class="col-12 col-md-4 mb-4 product-item" data-aos="zoom-in" data-date="<%= product.created_at %>" data-price="<%= product.price %>">
        <div class="card card-index">
          <%= cl_image_tag product.photo.key, alt: product.name, class: 'card-img-top rounded-top' if product.photo.present? %>
          <div class="card-body">
            <h4 class="fw-bold"><%= product.name %></h4>
            <div class="description">
              <p class="card-text"><%= product.description.truncate(100) %></p>
              <% if product.description.length > 100 %>
                <button class="btn btn-link more-btn">Ver más</button>
              <% end %>
            </div>
            <div class="full-description" style="display: none;">
              <p class="card-text"><%= product.description %></p>
              <button class="btn btn-link less-btn">Ver menos</button>
            </div>
            <div class="d-flex justify-content-between align-items-center">
              <strong><%= product.price %>💲</strong> <%= "📍caracas" %></h6>
              <%# Para reusar al momento de eliminar %>
              <%# <%= link_to 'delete this product', product_path(product), data: { turbo_method: :delete, turbo_confirm: '❌¿Are you sure you want to delete this product?❌' }, class: 'btn btn-light' %>
            </div>
            <% if user_signed_in? %>
              <div style="margin-top: 10px;">
                <%= link_to 'Comprar', product_path(product), class: 'btn btn-primary' %>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>

<%# funcion de orden en precio y fecha %>
<script>
  $(document).ready(function() {
    $("#SortBy").change(function() {
      var sortBy = $(this).val();
      if (sortBy == "price-descending") {
        sortProductsDescendingByPrice();
      } else if (sortBy == "price-ascending") {
        sortProductsAscendingByPrice();
      } else if (sortBy == "created-descending") {
        sortProductsDescendingByDate();
      } else if (sortBy == "created-ascending") {
        sortProductsAscendingByDate();
      }
    });

    function sortProductsDescendingByPrice() {
      var sortedItems = $(".product-item").sort(function(a, b) {
        return $(b).data("price") - $(a).data("price");
      });
      $("#productContainer").html(sortedItems);
    }

    function sortProductsAscendingByPrice() {
      var sortedItems = $(".product-item").sort(function(a, b) {
        return $(a).data("price") - $(b).data("price");
      });
      $("#productContainer").html(sortedItems);
    }

    function sortProductsDescendingByDate() {
      var sortedItems = $(".product-item").sort(function(a, b) {
        return new Date($(b).data("date")) - new Date($(a).data("date"));
      });
      $("#productContainer").html(sortedItems);
    }

    function sortProductsAscendingByDate() {
      var sortedItems = $(".product-item").sort(function(a, b) {
        return new Date($(a).data("date")) - new Date($(b).data("date"));
      });
      $("#productContainer").html(sortedItems);
    }

    $(".more-btn").click(function() {
      $(this).closest(".card-body").find(".description").hide();
      $(this).closest(".card-body").find(".full-description").show();
    });

    $(".less-btn").click(function() {
      $(this).closest(".card-body").find(".description").show();
      $(this).closest(".card-body").find(".full-description").hide();
    });
  });
</script>
<%# funcion de orden en precio y fecha %>

<%# card %>
